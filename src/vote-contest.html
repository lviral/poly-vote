<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="vote-contestant.html">

<dom-module id="vote-contest">
  <template>
    <style>
        :host {
            display: block;
            width: 100%;
            color: gray;
        }
        .text {
            width: 90%;
            margin: 0 auto;
            text-align: center;
        }
        .title {
            font-weight: bold;
            color: black;
        }
        .date {
            font-size: small;
        }
    </style>
      
    <firebase-document
      id="survey"
      path="/users/0/surveys/0"
      data="{{surveyData}}">
    </firebase-document>
      
    <firebase-document
      id="contestantOne"
      path="/users/0/surveys/0/contestants/0"
      data="{{oneData}}">
    </firebase-document>  
      
    <firebase-document
      id="contestantTwo"
      path="/users/0/surveys/0/contestants/1"
      data="{{twoData}}">
    </firebase-document>
    
    <div class="text title">[[surveyData.title]]</div>
    <vote-contestant image="{{oneData.image}}" name="{{oneData.name}}" float="right" style="float:right;" bar-color="#7baaf7" 
                     on-get-vote="_getVoteOne" disabled="{{disableOne}}" votes="{{oneData.votes}}" percent="{{percentOne}}">
    </vote-contestant>
    <vote-contestant image="{{twoData.image}}" name="{{twoData.name}}" on-get-vote="_getVoteTwo" disabled="{{disableTwo}}" 
                     votes="{{twoData.votes}}" percent="{{percentTwo}}"></vote-contestant>
    <br>
    <div class="text date">[[surveyData.date]]</div>
    <br>
    <div class="text">[[surveyData.description]]</div>
  </template>

  <script>
    Polymer({
        
      is: 'vote-contest',
      properties: {
          oneData: Object,
          twoData: Object,
          totalVotes: {
              type: Number,
              computed: '_getTotalVotes(oneData,twoData)'
          },
          percentOne: {
              type: Number,
              computed: '_getPercentOne(totalVotes)'
          },
          percentTwo: {
              type: Number,
              computed: '_getPercentTwo(totalVotes)'
          },
          disableOne: {
            type: Boolean
          },
          disableTwo: {
            type: Boolean
          }
      },
      _getVoteOne: function() {
          this.disableTwo = true;
      },
      _getVoteTwo: function() {
          this.disableOne = true;
      },
      _getTotalVotes: function(oneData,twoData) {
          return oneData.votes + twoData.votes;
      },
      _getPercentOne: function(totalVotes) {
          return Math.round((this.oneData.votes * 100) / totalVotes);
      },
      _getPercentTwo: function(totalVotes) {
          return Math.round((this.twoData.votes * 100) / totalVotes);
      }
    });
  </script>
</dom-module>
